# Требования и решение для прогрева данных в Tarantool Database

## Содержание
### [1. Требования к функции прогрева данных](#first)
### [2. Анализ реализации функции прогрева данных в других СУБД](#second)
### [3. Решение для Tarantool Database](#third)

<a name="first"></a>
## 1. Требования к функции прогрева данных

### 1) Автоматический прогрев при старте
Tarantool при старте должен автоматически загружать часто используемые данные из диска в RAM, учитывая статистику часто используемых данных. Прогрев не должен блокировать обработку запросов с бэкенда.

### 2) Сбор статистики и формирование списка наиболее популярных данных
Система должна непрерывно собирать статистику запросов на чтение для формирования списка наиболее популярных данных для переноса в RAM во время прогрева.

### 3) Сохранение списка наиболее популярных данных
Периодически и перед graceful shutdown сервера система должна сохранять список наиболее популярных данных.

### 4) Ручной запуск прогрева
Должна быть возможность вручную запустить прогрев указанного диапазона ключей через API.

### 5) Мониторинг
Система должна передавать метрики прогрева в Prometheus и впоследствии в Graphana для мониторинга и анализа.

### 6) Конфигурация прогрева
Система должна предоставлять возможность настраивать функцию прогрева данных (период сохранения списка, размер списка, выбор критичных/обязательных данных для прогрева и т.д.).

<a name="second"></a>
## 2. Анализ реализации функции прогрева данных в других СУБД

### 1) PostgreSQL (pg_prewarm)
Модуль pg_prewarm используется для загрузки таблиц и индексов в кэш буферов PostgreSQL или в кэш операционной системы.

Существует три режима работы: 
- prefetch (в этом режиме операционной системе выдаются асинхронные запросы предвыборки данных, если они поддерживаются, иначе происходит ошибка).
- read (в этом режиме считывается заданный диапазон блоков; считывание происходит синхронно и поддерживается во всех ОС любыми сборками; может выполняться медленнее prefetch и buffer).
- buffer (в этом режиме запрошенный диапазон блоков считывается в кеш буферов базы данных).

Ручной прогрев: SELECT pg_prewarm('table', 'buffer')

Автоматический прогрев: при добавлении pg_prewarm в shared_preload_libraries запускается фоновый воркер, который периодически сохраняет список загруженных блоков в файл autoprewarm.blocks и при запуске сервера восстанавливает их через два дополнительных фоновых процесса.

Таким образом, pg_prewarm с помощью всего одной функции дает возможность управлять прогревом даннных в PostgreSQL, но отсутствует статистический отбор данных по частоте обращений.

### 2) MongoDB (WiredTiger)

<a name="third"></a>
## 3. Решение для Tarantool Database
